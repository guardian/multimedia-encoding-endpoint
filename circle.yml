machine:
    services:
        - memcached
    php:
        version: 7.2.7
        
database:
    override:
        - mysql -u ubuntu circle_test < tests/_files/db_schema.sql

general:
    build_dir: endpoint
    
dependencies:
    pre:
        - yes | pecl install memcache
        - echo extension=memcache.so >> `php --ini | awk -F ':\\\\s*' '{print $2}' | grep php.ini`
        - echo error_reporting = E_ALL ^ E_DEPRECATED >> `php --ini | awk -F ':\\\\s*' '{print $2}' | grep php.ini`
        - sudo cp tests/_files/apache_config.conf /etc/apache2/sites-available/multimedia-endpoint.conf
        - sudo a2ensite multimedia-endpoint
        #fix dodgy libphp5.so symlink
        - sudo rm -f /usr/lib/apache2/modules/libphp7.so
        - sudo ln -s /opt/circleci/php/7.2.7/usr/lib/apache2/modules/libphp7.so /usr/lib/apache2/modules/libphp7.so
        - sudo cp /home/ubuntu/multimedia-encoding-endpoint/endpoint/tests/_files/endpoint.ini /etc
        - sudo service apache2 restart
        
test:
    override:
        - phpunit -c tests/phpunit.xml
